{% extends "base.html" %}

{% block content %}
<h1>Document Analysis RAG</h1>
<form id="url-form">
    <div class="mb-3">
        <label for="url" class="form-label">Enter URL:</label>
        <input type="url" class="form-control" id="url" name="url" required>
    </div>
    <button type="submit" class="btn btn-primary">Process</button>
</form>
<div id="result" class="mt-3"></div>

<script>
document.getElementById('url-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var url = document.getElementById('url').value;
    var resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p>Processing... Please wait.</p>';
    fetch('/process', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'url=' + encodeURIComponent(url)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = '<p class="text-success">' + data.message + '</p>';
        } else {
            resultDiv.innerHTML = '<p class="text-danger">' + data.message + '</p>';
        }
    })
    .catch(error => {
        resultDiv.innerHTML = '<p class="text-danger">Error: ' + error.message + '</p>';
    });
});
</script>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#add-website-form').submit(function(e) {
        e.preventDefault();
        $.ajax({
            url: '/add_website',
            method: 'POST',
            data: { url: $('#website-url').val() },
            success: function(response) {
                $('#add-website-result').text(response.message);
            },
            error: function(xhr) {
                $('#add-website-result').text('Error: ' + xhr.responseJSON.error);
            }
        });
    });

    $('#query-form').submit(function(e) {
        e.preventDefault();
        $.ajax({
            url: '/query',
            method: 'POST',
            data: { query: $('#query-text').val() },
            success: function(response) {
                $('#query-result').html('<h3>Results:</h3><ul>' + 
                    response.results.map(result => '<li>' + result + '</li>').join('') + 
                    '</ul>');
            },
            error: function(xhr) {
                $('#query-result').text('Error: ' + xhr.responseJSON.error);
            }
        });
    });
});
</script>
{% endblock %}